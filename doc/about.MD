## 照片墙 Web 应用（前端）PRD v0.1

> 这是我的全局 PRD，请理解并确认。

### 1. 背景与目标
- 做一个纯前端的照片墙 Web 应用：用户可制作“布局（Layout）”、编辑“照片墙房（Room）”，并导出单页或整册 zip。
- 先 PC（完整编辑能力），后移动端（轻交互：选模板 + 按序号上传填充 + 导出）。

#### 1.0 产品背景（补充）
- 需求变化：用户拍照量巨大，但整理与成册成本高，导致“照片有、作品少”。
- 现有痛点：模板平台缺少主题氛围、操作复杂、输出不适配打印或社媒。
- 产品定位：做“主题化、轻制作、高完成率”的照片墙工具，让用户在特定场景下快速出片。
- 核心价值：主题氛围 + 低门槛编辑 + 高质量导出。
- 差异化：更强主题故事线 + 可自定义布局 + 本地离线编辑与导出。

#### 1.1 目标用户与场景（产品视角）
- 目标用户：学生/教师（毕业季）、家庭用户（春节/团圆）、情侣/朋友（纪念日/旅行）、社团/团队（活动复盘）。
- 典型场景：毕业纪念册、春节团圆照墙、旅行相册、活动总结墙。
- 用户动机：快速出片、主题氛围强、编辑门槛低、可分享/可打印。

#### 1.2 目标指标（可量化）
- 完成率：进入编辑后成功导出的用户占比。
- 平均完成时长：从创建 Room 到导出所需时间。
- 模板转化：选择模板后完成导出比例。
- 留存信号：7 日内再次打开并继续编辑的占比（仅本地存储场景）。

### 2. 技术栈与部署
- 技术栈：Next.js + React + TailwindCSS
- 部署：Vercel
- 风格：现代、自然、简洁、玻璃质感（Glassmorphism）

> 说明：Next.js 与 Vite 通常不同时使用；以 Next.js（App Router）为主。

#### 2.1 导出尺寸口径（产品 + 技术落地）
- A4：建议 300 DPI，导出尺寸约 2480 x 3508 px（竖版）。
- 9:16：导出尺寸建议 1080 x 1920 px（社媒通用），可升到 2160 x 3840 px（2x）。
- 1:1：导出尺寸建议 1080 x 1080 px，可升到 2160 x 2160 px（2x）。
- 分辨率选项：1x / 2x / 3x（3x 需提示性能风险）。
- 打印提示：导出时可显示“打印清晰度提示”，避免用户误用低分辨率导出。

#### 2.2 视觉设计系统（全局）
- 设计方向：玻璃质感 + 叠层拼贴 + 现代杂志感（叙事、留白、节奏感）。
- 版式系统：12 列栅格 + 8px 间距体系；大留白与大字号并存。
- 字体建议：标题使用 Playfair Display（情绪/纪念），正文使用 Inter（可替换 Source Sans 3 以减轻“默认感”）。
- 颜色基调（全局）：Primary #EC4899，CTA #06B6D4，Background #FDF2F8，Text #831843。
- 主题色覆盖：
  - 毕业季：雾蓝 #9FB7D8、奶白 #F6F1EA、浅紫 #C7B2DD、强调色 #6B6EF5。
  - 春节：正红 #C81E1E、金色 #F5C542、暖黑 #1F1A17、米白 #FFF6E8。
- 交互与动效：200-300ms 过渡；主要使用 opacity/transform；支持 prefers-reduced-motion。
- 图标规范：统一使用 SVG 图标（如 Lucide），避免 emoji 作为 UI 图标。

### 3. 主题（首发两套）
#### 3.1 毕业季（青春纪念）
- 视觉：雾蓝/奶白/浅紫渐变 + 玻璃卡片叠层 + 轻噪点
- 贴纸方向：胶带、拍立得边框、纸张撕边、手写涂鸦

特有内容与服务：
- 一键文案：毕业寄语、同学留言、班级口号、老师寄语模板。
- 章节引导：入学-相识-比赛-合影-毕业（按页引导提示）。
- 主题素材：校徽/校名可编辑占位、课堂/操场/社团元素图标。
- 细节玩法：签名墙（手写签名贴纸）、时间轴装饰线。

#### 3.2 春节（红红火火团圆）
- 视觉：中国红主色 + 金色点缀 + 磨砂玻璃叠层
- 贴纸方向：灯笼、窗花、烟花、福字、祥云

特有内容与服务：
- 一键文案：新年祝福、家族称呼、团圆语、年味标题。
- 节日元素：年夜饭、年货、红包、拜年元素贴纸。
- 氛围边框：春联边框、福字角标、金粉边框。
- 互动页：拜年页/合影页/年夜饭页引导模板。

### 4. 核心概念与层级
- Room：一个“册子/房间”（例如同学册整体）
- Page/Wall：Room 的一页/一面墙（每页可单独布局与装饰）
- Layout：网格布局模板（定义照片格子如何分布）
- Cell（Region）：照片格子（由多个小方块组成，可不规则，可留白/空洞）
- Decorations：装饰层（文本、贴纸、形状、背景、滤镜）

层级模型：
- Room -> Pages/Walls -> Layout -> Cells + Decorations

### 5. 数据模型（工程内存/持久化结构）
#### 5.1 Room
- id: string
- name: string
- themeId: "graduation" | "springFestival" | string
- pages: Page[]
- coverDecorations?: Decoration[]（可选：用于封面/外圈版式）
- createdAt, updatedAt: number

#### 5.2 Page / Wall
- id: string
- sizePreset: "A4" | "9:16" | "1:1"
- layoutId: string
- cellStates: Record<regionId, CellState>
- decorations: Decoration[]
- background: Background
- filter: PageFilter（整页滤镜）

#### 5.3 Layout
- id: string
- name: string
- cols: number
- rows: number
- regions: Region[]

#### 5.4 Region / CellDef（不规则格子）
- id: string
- order: number（自动生成 1,2,3...）
- cells: Array<[x: number, y: number]>（每个坐标对应一个小方块）

约束：
- 网格定义：cols * rows 任意方块
- 圈选规则：允许不规则形状
- 冲突规则：不允许覆盖已占用区域
- 允许留白：未被任何 Region 占用的方块为空白
- 连通性（默认口径）：同一 Region 的 cells 需四邻接连通（便于编辑与渲染）

#### 5.5 CellState（每个格子的图片与视图）
- regionId: string
- assetId?: string
- fitMode: "cover" | "contain"
- pan: { x: number; y: number }
- zoom: number
- rotate: 0 | 90 | 180 | 270

#### 5.6 Asset（图片资源）
- id: string
- name: string
- mime: string
- width: number
- height: number
- size: number
- storageKey: string（IndexedDB key）

#### 5.7 Decoration（装饰元素）
- id: string
- type: "text" | "sticker" | "shape"
- transform: { x: number; y: number; scaleX: number; scaleY: number; rotation: number }
- style: Record<string, unknown>
- zIndex: number

#### 5.8 Background / Filter
- Background：颜色 / 渐变 / 图片（可选）
- Filter：整页滤镜（例如 gray/contrast/warm 等），作用对象为 Page/Wall

#### 5.9 本地持久化策略（技术落地）
- 存储层：IndexedDB（存图片二进制与项目 JSON），localStorage 仅存轻量索引。
- 自动保存：编辑行为后 2-5 秒节流写入；退出前强制保存。
- 版本与兼容：数据结构带 version 字段，升级时做迁移。
- 清理策略：项目超过阈值提示清理；可按 Room 维度删除。
- 限制说明：跨浏览器不可见，同一浏览器可续编辑。

### 6. 功能需求与验收标准

#### 6.1 照片墙打造（Layout Builder）
功能：
- 用户设置 cols * rows 的网格。
- 用户使用“圈选/画笔”方式选择多个小格组成一个 Region（允许凹形、允许空洞）。
- 圈选时不可选已占用小格（不允许覆盖）。
- Region 完成后自动生成序号 order（按创建顺序递增）。
- 支持编辑：撤销、删除 Region、清空 Layout、重新编号（可选）。
- 保存 Layout 供 Page 使用。

验收：
- 可制作九宫格。
- 可制作中间空心爱心（不规则 + 留白/空洞）。
- 可制作奥运五环（多 Region + 留白）。

#### 6.2 格子填图、上传与拖拽交换
上传来源：
- 支持点击导入本地文件。
- 支持拖拽文件到指定格子导入。

交换/移动逻辑（默认口径）：
- 拖拽到已有图片的格子：交换两格图片与视图参数。
- 拖拽到空格子：移动过去（源格子清空）。

图片适配与编辑：
- fitMode：cover/contain 可切换。
- 支持平移（拖动）与缩放（滚轮/手势，移动端后续）。
- 旋转先做 90° 步进（0/90/180/270）。
- 支持重置视图（pan/zoom/rotate 回默认）。

图片处理：
- 不做压缩。
- 限制：单张图片 ≤ 20MB；非图片类型拒绝；可提示格式不支持。

验收：
- 拖拽交换与移动符合预期，无错位与闪烁。
- 图片调整仅影响当前格子，不影响其它格子。

补充体验要求：
- 撤销/重做：至少支持图片放置、移动、替换、删除等操作。
- 快捷键：PC 支持删除、撤销/重做、复制/粘贴（装饰层）。
- 吸附与对齐：装饰层移动时提供吸附提示线。


#### 6.3 Room（多页）编辑与装饰
Room：
- 创建 Room（可命名）。
- 重命名 Room。

Pages/Walls：
- 新增/删除/排序页面（上限 10）。
- 每页选择尺寸预设：A4 / 9:16 / 1:1（未来扩展自定义宽高）。
- 每页可选择 Layout 并填图。

装饰（Page/Wall 级别）：
- 文本：输入/字体/大小/颜色/阴影/描边（先做基础属性）。
- 贴纸：内置素材 + 主题素材。
- 形状：矩形/圆形/线条（先做基础）。
- 背景：纯色/渐变/图片（可选）。
- 滤镜：整页滤镜（作用范围为 Page/Wall）。

验收：
- 同一个 Room 可像同学册一样逐页编辑，每页可独立装饰与导出。

#### 6.4 工坊模板
模板类型：
- Layout 模板：九宫格、爱心墙、奥运五环等（可复用到任意 Page）。
- Room 模板：整册成品（用户替换图片即可）。

推荐模板类型（扩展）：
- 留白叙事型：大面积留白 + 3-6 张重点照（适合毕业寄语/春节祝福）。
- 时间轴型：横向或纵向时间线（适合毕业成长记录/春节家庭合影）。
- 合影中心型：中心大图 + 周围小图环绕（适合毕业合影/团圆合影）。
- 电影海报型：一张主图 + 标题 + 副标题 + 小拼贴（适合毕业季主题页）。
- 风格拼贴型：不规则拼贴 + 贴纸边框（适合节日氛围与旅行）。

主题模板推荐（可作为首发资源包）：
- 毕业季：
  - “同学录封面”：一张主合影 + 班级名 + 年份。
  - “成长时间轴”：入学-比赛-出游-毕业。
  - “留言墙”：签名位 + 留言卡片。
  - “老师寄语页”：留白 + 重点语录。
- 春节：
  - “团圆合影封面”：中间合影 + 春联边框。
  - “年夜饭记录”：九宫格/三栏拼贴。
  - “拜年页”：祝福文案 + 福字角标。
  - “红包页”：红包贴纸 + 家人称呼位。

模板使用：
- 选择模板后创建新 Room（基于模板复制）。
- 在模板中按 Region 序号提示用户填图（尤其面向移动端轻交互）。

验收：
- 用户可快速选模板并按序号填满图片，完成一本照片墙记。

#### 6.5 导出与分享
导出类型：
- 单页导出：PNG（可选 JPG 作为后续扩展）。
- 整册导出：每页导出 PNG 后打包 zip 下载（文件名含页码与页名/序号）。

分辨率策略：
- 导出分辨率为可选项（例如 1x / 2x / 3x）。
- 默认：2x；若设备性能不足或导出失败，可降到 1x。

工程文件：
- 暂不支持“工程文件导入”。
- 允许本地自动保存以便继续编辑（同浏览器环境）。

验收：
- 单页导出与预览一致。
- zip 内页序与命名正确，可直接分享。

导出稳定性要求（技术落地）：
- 大图导出提示：导出 2x/3x 若失败自动降级 1x 并提示。
- 导出耗时提示：超过 3 秒显示进度与取消按钮。

### 7. 性能与限制（首版约束）
- 单个 Room 最大页数：10
- 单页最大格子数：100（regions 数量）；网格总格数建议设上限（例如 ≤ 400）
- 单张图片最大体积：20MB（不压缩）
- 目标设备：PC 优先；移动端首版仅模板填充与导出（不做复杂编辑）

### 8. 交互与 UI 规范（玻璃质感）
- 主要容器使用半透明背景 + 背景模糊（backdrop-blur）+ 轻边框/阴影。
- 操作面板：右侧属性栏（PC），移动端用底部抽屉（后续）。
- 关键流程：选模板/新建 -> 编辑页 -> 按序号填图 -> 装饰 -> 导出。

### 9. 里程碑（建议实施顺序）
- M1：Layout Builder（不规则圈选 + 序号 + 保存）
- M2：格子上传与拖拽交换 + 图片适配编辑
- M3：Room/Pages 管理（多页、尺寸预设、保存）
- M4：装饰层（文本/贴纸/形状/背景/整页滤镜）
- M5：模板工坊（Layout 模板 + Room 模板）
- M6：导出（单页 + zip）与分辨率可选

### 10. 项目结构（Next.js App Router 建议）
- app/
- app/(home)/page.tsx（首页/模板入口）
- app/editor/page.tsx（编辑器主界面）
- app/templates/page.tsx（模板工坊）
- app/export/page.tsx（导出预览页，可选）
- components/
- components/editor/（画布、工具栏、属性面板）
- components/layout-builder/（圈选工具、网格与区域）
- components/decorations/（贴纸、文本、形状）
- components/ui/（基础 UI：按钮、弹窗、抽屉）
- features/
- features/room/（Room/Pages 数据与逻辑）
- features/layout/（Layout 与 Region 逻辑）
- features/assets/（图片导入与管理）
- features/export/（导出与 zip 打包）
- features/templates/（模板加载与复制）
- lib/
- lib/storage/（IndexedDB、本地持久化）
- lib/geometry/（区域/碰撞/连通性）
- lib/render/（导出渲染与分辨率策略）
- data/
- data/themes/（主题配置 JSON）
- data/templates/（Layout/Room 模板数据）
- styles/（全局样式、主题变量）
- types/（数据模型类型）
- public/assets/（贴纸与主题素材）

### 11. 阶段落地与交付物（产品化 + 技术落地）
- Phase 0：项目初始化与基础框架
  - 交付：路由结构、基础 UI 组件、全局主题变量、空白编辑器壳。
- Phase 1（M1）：Layout Builder
  - 交付：网格系统、圈选 Region、保存 Layout、基础模板（九宫格/爱心/五环）。
- Phase 2（M2）：图片导入与格子编辑
  - 交付：拖拽上传、交换/移动、缩放/平移/旋转、撤销/重做。
- Phase 3（M3）：Room/Pages 管理
  - 交付：多页管理、尺寸预设、自动保存、页面排序与预览。
- Phase 4（M4）：装饰层
  - 交付：文本/贴纸/形状、背景/滤镜、对齐吸附、基础字体与主题素材。
- Phase 5（M5）：模板工坊
  - 交付：Room 模板、主题模板推荐、移动端按序号填图流程。
- Phase 6（M6）：导出与分享
  - 交付：单页导出、整册 zip、分辨率策略、导出进度与降级提示。

### 12. 成品定义（验收口径）
- 用户可 10 分钟内完成一份主题照片墙并导出高清 PNG/zip。
- 毕业季与春节至少各 6 套主题模板可用。
- PC 完整编辑可用，移动端可模板填充与导出。
